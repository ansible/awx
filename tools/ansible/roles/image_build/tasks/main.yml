---
- name: Verify awx-logos directory exists for official install
  stat:
    path: "../../../awx-logos"
  register: logosdir
  failed_when: logosdir.stat.isdir is not defined or not logosdir.stat.isdir
  when: awx_official|default(false)|bool

- name: Copy logos for inclusion in sdist
  copy:
    src: "../../../awx-logos/awx/ui/client/assets/"
    dest: "../../awx/ui/public/static/media/"
  when: awx_official|default(false)|bool

- name: Build AWX image
  shell: "make awx-kube-build"
  environment:
    VERSION: "{{ awx_version }}"
    HEADLESS: "{{ headless }}"
    COMPOSE_TAG: "{{ awx_image_tag }}"

  args:
    chdir: "{{ playbook_dir }}/../../"
